<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Sliding Puzzle</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            height: 100vh;
            margin: 0;
            background: #f0f8ff;
            font-family: Arial, sans-serif;
        }

        h2 {
            margin-bottom: 10px;
        }

        #score {
            margin-bottom: 15px;
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }

        #puzzle {
            display: grid;
            grid-template-columns: repeat(3, 100px);
            grid-template-rows: repeat(3, 100px);
            gap: 5px;
        }

        .tile {
            width: 100px;
            height: 100px;
            background: #1c16d6;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            border-radius: 8px;
            transition: background 0.3s;
        }

        .tile:hover {
            background: #b3b4b3;
        }

        .empty {
            background: transparent;
            border: 2px dashed #bbb;
            cursor: default;
        }

        .buttons {
            margin-top: 20px;
            display: flex;
            gap: 10px;
        }

        button {
            padding: 10px 20px;
            font-size: 16px;
            border: none;
            border-radius: 8px;
            background: #333;
            color: white;
            cursor: pointer;
        }

        button:hover {
            background: #555;
        }

        #goBackBtn {
            position: absolute;
            top: 15px;
            left: 15px;
            background: #444;
            color: white;
            border: none;
            padding: 8px 14px;
            font-size: 14px;
            cursor: pointer;
            border-radius: 6px;
        }

        #goBackBtn:hover {
            background: #666;
        }
    </style>
</head>

<body>
    <button id="goBackBtn" onclick="window.location.href='index.html'">‚¨Ö Go Back</button>
    <h2>Sliding Puzzle (Arrange 1‚Äì8)</h2>
    <div id="score">Moves: 0</div>
    <div id="puzzle"></div>

    <div class="buttons">
        <button id="resetBtn">Shuffle</button>
        <button id="submitBtn" onclick="submitScore()">Submit Score</button>
    </div>

    <script>
        const puzzle = document.getElementById("puzzle");
        const resetBtn = document.getElementById("resetBtn");
        const submitBtn = document.getElementById("submitBtn");
        const scoreDisplay = document.getElementById("score");

        let tiles = [];
        let moves = 0;
        let gameOver = false;

        function createPuzzle() {
            puzzle.innerHTML = "";
            tiles.forEach(num => {
                const div = document.createElement("div");
                div.classList.add("tile");
                if (num === 0) {
                    div.classList.add("empty");
                } else {
                    div.textContent = num;
                    div.addEventListener("click", () => moveTile(num));
                }
                puzzle.appendChild(div);
            });
        }

        function shufflePuzzle() {
            do {
                tiles = [1, 2, 3, 4, 5, 6, 7, 8, 0];
                // Fisher-Yates shuffle
                for (let i = tiles.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [tiles[i], tiles[j]] = [tiles[j], tiles[i]];
                }
            } while (!isSolvable(tiles));
            moves = 0;
            gameOver = false;
            updateScore();
            createPuzzle();
        }

        // Check if the puzzle is solvable
        function isSolvable(arr) {
            let invCount = 0;
            for (let i = 0; i < arr.length - 1; i++) {
                for (let j = i + 1; j < arr.length; j++) {
                    if (arr[i] && arr[j] && arr[i] > arr[j]) invCount++;
                }
            }
            // For 3x3 puzzle, solvable if inversion count is even
            return invCount % 2 === 0;
        }

        function moveTile(num) {
            const index = tiles.indexOf(num);
            const emptyIndex = tiles.indexOf(0);

            const validMoves = [
                emptyIndex - 1,
                emptyIndex + 1,
                emptyIndex - 3,
                emptyIndex + 3
            ];

            if (validMoves.includes(index)) {
                [tiles[index], tiles[emptyIndex]] = [tiles[emptyIndex], tiles[index]];
                moves++;
                updateScore();
                createPuzzle();
                checkWin();
            }
        }
        function submitScore() {
            if (!gameOver) {
                alert("‚ùå Finish the game before submitting score!");
                return;
            }
            localStorage.setItem("lastScore", moves);
            // Here you could send the score to a server/database
            // Example: fetch("/submit", { method:"POST", body: JSON.stringify({ score: moves }) })
            alert("‚úÖ Your score has been submitted! Total moves: " + moves);
            // Redirect to another page if needed
            // window.location.href = "admin.html";
        }
        function updateScore() {
            scoreDisplay.textContent = "Moves: " + moves;
        }

        function checkWin() {
            if (tiles.join(",") === "1,2,3,4,5,6,7,8,0") {
                gameOver = true;
                // Using setTimeout ensures the UI updates before showing the alert.
                setTimeout(() => alert("üéâ You solved the puzzle in " + moves + " moves!"), 200);
            }
        }

        submitBtn.addEventListener("click", submitScore);
        shufflePuzzle(); // Start shuffled

        function submitScore() {
            if (!gameOver) {
                alert("‚ùå Finish the game before submitting score!");
                return;
            }
            localStorage.setItem("lastnqScore", moves);
            // Here you could send the score to a server/database
            // Example: fetch("/submit", { method:"POST", body: JSON.stringify({ score: moves }) })
            alert("‚úÖ Your score has been submitted! Total moves: " + moves);
            // Redirect to another page if needed
            // window.location.href = "admin.html";
        }
    </script>
</body>

</html>